"use strict";(self["webpackChunkweek_8_project"]=self["webpackChunkweek_8_project"]||[]).push([[529],{1586:function(e,t,a){a.d(t,{Z:function(){return v}});var s=a(6252),l=a(3577);const i={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},o={class:"modal-dialog",role:"document"},d={class:"modal-content border-0"},r={class:"modal-header bg-danger text-white"},n={class:"modal-title"},c=(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),h={class:"modal-body"},u=(0,s.Uk)(" 是否刪除 "),p={class:"text-danger"},g=(0,s.Uk)(" (刪除後將無法恢復)。 "),_={class:"modal-footer"},m=(0,s._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function w(e,t,a,w,b,k){return(0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("div",o,[(0,s._)("div",d,[(0,s._)("div",r,[(0,s._)("h5",n,[(0,s._)("span",null,"刪除 "+(0,l.zw)(b.orderShow.title),1)]),c]),(0,s._)("div",h,[u,(0,s._)("strong",p,(0,l.zw)(b.orderShow.title),1),g]),(0,s._)("div",_,[m,(0,s._)("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...e)=>k.updateModal&&k.updateModal(...e))}," 確認刪除 ")])])])],512)}var b=a(7424),k=a.n(b),y={props:["order"],data(){return{modal:"",orderShow:{}}},watch:{order(){this.orderShow=this.order}},emits:["del-item"],methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},updateModal(){this.$emit("del-item")}},mounted(){this.modal=new(k())(this.$refs.modal)}},D=a(3744);const f=(0,D.Z)(y,[["render",w]]);var v=f},3106:function(e,t,a){a.d(t,{Z:function(){return m}});var s=a(6252),l=a(3577),i=a(9963);const o={"aria-label":"Page navigation"},d={class:"pagination justify-content-center"},r=["aria-disabled"],n={key:0,class:"page-link link-dark fw-bold"},c=["onClick"],h=["aria-disabled"];function u(e,t,a,u,p,g){return(0,s.wg)(),(0,s.iD)("nav",o,[(0,s._)("ul",d,[(0,s._)("li",{class:(0,l.C_)(["page-item",{disabled:!a.hasPre}])},[(0,s._)("a",{class:"page-link link-dark fw-bold",href:"#",tabindex:"-1","aria-disabled":!a.hasPre,onClick:t[0]||(t[0]=(0,i.iM)((e=>g.emitData(a.currentPage-1)),["prevent"]))},"上吐",8,r)],2),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.totalPages,((e,t)=>((0,s.wg)(),(0,s.iD)("li",{class:(0,l.C_)(["page-item",{active:e===a.currentPage}]),key:t},[e===a.currentPage?((0,s.wg)(),(0,s.iD)("span",n,(0,l.zw)(e),1)):((0,s.wg)(),(0,s.iD)("a",{key:1,class:"page-link link-dark fw-bold",href:"#",onClick:(0,i.iM)((t=>g.emitData(e)),["prevent"])},(0,l.zw)(e),9,c))],2)))),128)),(0,s._)("li",{class:(0,l.C_)(["page-item",{disabled:!a.hasNext}])},[(0,s._)("a",{class:"page-link fw-bold",href:"#","aria-disabled":!a.hasNext,onClick:t[1]||(t[1]=(0,i.iM)((e=>g.emitData(a.currentPage+1)),["prevent"]))},"下瀉",8,h)],2)])])}var p={data(){return{}},props:["currentPage","hasPre","hasNext","totalPages"],methods:{emitData(e){this.$emit("click-page",e)}}},g=a(3744);const _=(0,g.Z)(p,[["render",u]]);var m=_},3529:function(e,t,a){a.r(t),a.d(t,{default:function(){return De}});var s=a(6252),l=a(3577),i=a(9963);const o=(0,s._)("h2",{class:"my-5 ms-2 fw-bold text-center"},"訂單管理頁面",-1),d={class:"p-5"},r={class:"table mt-4"},n=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",{scope:"col"},"訂單號"),(0,s._)("th",{scope:"col"},"下訂時間"),(0,s._)("th",{scope:"col"},"Email"),(0,s._)("th",{scope:"col"},"購買品項"),(0,s._)("th",{scope:"col"},"應付金額"),(0,s._)("th",{scope:"col"},"是否付款"),(0,s._)("th",{scope:"col"},"編輯")])],-1),c={key:0},h={key:0},u={class:"list-group-numbered"},p={class:"text-right"},g={class:"form-check form-switch"},_=["id","onUpdate:modelValue","onChange"],m=["for"],w={key:0},b={key:1},k={class:"btn-group"},y=["onClick","disabled"],D={class:"spinner-grow spinner-grow-sm"},f=(0,s.Uk)(" 檢視 "),v=["onClick","disabled"],x={class:"spinner-grow spinner-grow-sm"},S=(0,s.Uk)(" 刪除 ");function L(e,t,a,L,M,$){const P=(0,s.up)("PageLoading"),C=(0,s.up)("OrderDetail"),z=(0,s.up)("OrderDelete"),I=(0,s.up)("PaginationFooter");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(P,{loader:"bars",active:M.isLoading,"can-cancel":!0,"is-full-page":!1},null,8,["active"]),o,(0,s._)("div",d,[(0,s._)("table",r,[n,M.orders.length?((0,s.wg)(),(0,s.iD)("tbody",c,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(M.orders,((e,t)=>((0,s.wg)(),(0,s.iD)("tr",{key:t,class:(0,l.C_)({"text-secondary":!e.is_paid})},[(0,s._)("td",null,(0,l.zw)(e.id),1),(0,s._)("td",null,(0,l.zw)(e.create_at),1),e.user?((0,s.wg)(),(0,s.iD)("td",h,(0,l.zw)(e.user.email),1)):(0,s.kq)("",!0),(0,s._)("td",null,[(0,s._)("ul",u,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.products,((e,t)=>((0,s.wg)(),(0,s.iD)("li",{class:"list-group-item",key:t},(0,l.zw)(e.product.title)+" 數量："+(0,l.zw)(e.qty)+" "+(0,l.zw)(e.product.unit),1)))),128))])]),(0,s._)("td",p,(0,l.zw)(e.total)+" 元",1),(0,s._)("td",null,[(0,s._)("div",g,[(0,s.wy)((0,s._)("input",{class:"form-check-input",type:"checkbox",id:`switch${e.id}`,"onUpdate:modelValue":t=>e.is_paid=t,onChange:t=>$.updatePaid(e)},null,40,_),[[i.e8,e.is_paid]]),(0,s._)("label",{class:"form-check-label",for:`switch${e.id}`},[e.is_paid?((0,s.wg)(),(0,s.iD)("span",w,"已付款")):((0,s.wg)(),(0,s.iD)("span",b,"未付款"))],8,m)])]),(0,s._)("td",null,[(0,s._)("div",k,[(0,s._)("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:t=>$.openModal(e),disabled:M.isLoadingItem===e.id},[(0,s.wy)((0,s._)("span",D,null,512),[[i.F8,M.isLoadingItem===e.id]]),f],8,y),(0,s._)("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:t=>$.openDelModal(e),disabled:M.isLoadingItem===e.id},[(0,s.wy)((0,s._)("span",x,null,512),[[i.F8,M.isLoadingItem===e.id]]),S],8,v)])])],2)))),128))])):(0,s.kq)("",!0)])]),(0,s.Wm)(C,{order:M.orderShow,ref:"orderDetail",onUpdatePaid:$.updatePaid},null,8,["order","onUpdatePaid"]),(0,s.Wm)(z,{order:M.orderShow,ref:"delModal",onDelItem:$.delOrder},null,8,["order","onDelItem"]),(0,s.Wm)(I,{"current-page":M.current_page,"has-pre":M.has_pre,"has-next":M.has_next,"total-pages":M.total_pages,onClickPage:$.getOrders},null,8,["current-page","has-pre","has-next","total-pages","onClickPage"])],64)}const M={class:"modal fade",tabindex:"-1",role:"dialog",id:"orderDetail","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},$={class:"modal-dialog modal-xl",role:"document"},P={class:"modal-content border-0"},C=(0,s._)("div",{class:"modal-header bg-dark text-white"},[(0,s._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,s._)("span",null,"訂單細節")]),(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),z={class:"modal-body"},I={class:"row"},O={class:"col-md-4"},F=(0,s._)("h3",null,"用戶資料",-1),U={class:"table"},Y={key:0},Z=(0,s._)("th",{style:{width:"100px"}},"姓名",-1),q=(0,s._)("th",null,"Email",-1),H=(0,s._)("th",null,"電話",-1),N=(0,s._)("th",null,"地址",-1),j={class:"col-md-8"},K=(0,s._)("h3",null,"訂單細節",-1),W={class:"table"},V=(0,s._)("th",{style:{width:"100px"}},"訂單編號",-1),E=(0,s._)("th",null,"下單時間",-1),T=(0,s._)("th",null,"付款時間",-1),A={key:0},B={key:1},G=(0,s._)("th",null,"付款狀態",-1),J={key:0,class:"text-success"},Q={key:1,class:"text-muted"},R=(0,s._)("th",null,"總金額",-1),X=(0,s._)("h3",null,"選購商品",-1),ee={class:"table"},te=(0,s._)("thead",null,[(0,s._)("tr")],-1),ae={class:"text-end"},se={class:"d-flex justify-content-end"},le={class:"form-check"},ie={class:"form-check-label",for:"flexCheckDefault"},oe={key:0},de={key:1},re={class:"modal-footer"},ne=(0,s._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ce(e,t,a,o,d,r){return(0,s.wg)(),(0,s.iD)("div",M,[(0,s._)("div",$,[(0,s._)("div",P,[C,(0,s._)("div",z,[(0,s._)("div",I,[(0,s._)("div",O,[F,(0,s._)("table",U,[d.orderShow.user?((0,s.wg)(),(0,s.iD)("tbody",Y,[(0,s._)("tr",null,[Z,(0,s._)("td",null,(0,l.zw)(d.orderShow.user.name),1)]),(0,s._)("tr",null,[q,(0,s._)("td",null,(0,l.zw)(d.orderShow.user.email),1)]),(0,s._)("tr",null,[H,(0,s._)("td",null,(0,l.zw)(d.orderShow.user.tel),1)]),(0,s._)("tr",null,[N,(0,s._)("td",null,(0,l.zw)(d.orderShow.user.address),1)])])):(0,s.kq)("",!0)])]),(0,s._)("div",j,[K,(0,s._)("table",W,[(0,s._)("tbody",null,[(0,s._)("tr",null,[V,(0,s._)("td",null,(0,l.zw)(d.orderShow.id),1)]),(0,s._)("tr",null,[E,(0,s._)("td",null,(0,l.zw)(r.CreateDate),1)]),(0,s._)("tr",null,[T,(0,s._)("td",null,[d.orderShow.paid_date?((0,s.wg)(),(0,s.iD)("span",A,(0,l.zw)(r.PaidDate),1)):((0,s.wg)(),(0,s.iD)("span",B,"時間不正確"))])]),(0,s._)("tr",null,[G,(0,s._)("td",null,[d.orderShow.is_paid?((0,s.wg)(),(0,s.iD)("strong",J,"已付款")):((0,s.wg)(),(0,s.iD)("span",Q,"尚未付款"))])]),(0,s._)("tr",null,[R,(0,s._)("td",null,(0,l.zw)(d.orderShow.total),1)])])]),X,(0,s._)("table",ee,[te,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(d.orderShow.products,(e=>((0,s.wg)(),(0,s.iD)("tr",{key:e.id},[(0,s._)("th",null,(0,l.zw)(e.product.title),1),(0,s._)("td",null,(0,l.zw)(e.qty)+" / "+(0,l.zw)(e.product.unit),1),(0,s._)("td",ae,(0,l.zw)(e.final_total),1)])))),128))])]),(0,s._)("div",se,[(0,s._)("div",le,[(0,s.wy)((0,s._)("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":t[0]||(t[0]=e=>d.orderShow.is_paid=e)},null,512),[[i.e8,d.orderShow.is_paid]]),(0,s._)("label",ie,[d.orderShow.is_paid?((0,s.wg)(),(0,s.iD)("span",oe,"已付款")):((0,s.wg)(),(0,s.iD)("span",de,"未付款"))])])])])])]),(0,s._)("div",re,[ne,(0,s._)("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=(...e)=>r.updateOrder&&r.updateOrder(...e))}," 修改付款狀態 ")])])])],512)}var he=a(7424),ue=a.n(he),pe={props:["order"],data(){return{status:{},modal:"",orderShow:{},isPaid:!1}},computed:{CreateDate(){const e=new Date(1e3*this.orderShow.create_at),t=e.getFullYear(),a=e.getMonth()+1,s=e.getDate(),l=`${t}/${a}/${s}`;return l},PaidDate(){const e=new Date(1e3*this.orderShow.is_paid),t=e.getFullYear(),a=e.getMonth()+1,s=e.getDate(),l=`${t}/${a}/${s}`;return l}},watch:{order(){this.orderShow=this.order}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},updateOrder(){this.$emit("update-paid",this.orderShow)}},mounted(){this.modal=new(ue())(document.querySelector("#orderDetail"))}},ge=a(3744);const _e=(0,ge.Z)(pe,[["render",ce]]);var me=_e,we=a(1586),be=a(3106),ke={data(){return{orders:{},isNew:!1,current_page:1,has_next:!1,has_pre:!1,isLoading:!1,isLoadingItem:"",total_pages:1,orderShow:{},currentPage:1}},components:{PaginationFooter:be.Z,OrderDelete:we.Z,OrderDetail:me},methods:{dateTimeFormat(e){const t=new Date(1e3*e),a=t.getFullYear(),s=t.getMonth()+1,l=t.getDate(),i=`${a}/${s}/${l}`;return i},getOrders(e=1){this.isLoading=!0,this.currentPage=e;const t=`https://vue3-course-api.hexschool.io/v2//api/brunoyu2022/admin/orders?page=${e}`;this.$http.get(t,e).then((e=>{this.orders=e.data.orders.map((e=>({...e,create_at:this.dateTimeFormat(e.create_at)}))),this.current_page=e.data.pagination.current_page,this.has_next=e.data.pagination.has_next,this.has_pre=e.data.pagination.has_pre,this.total_pages=e.data.pagination.total_pages,this.isLoading=!1})).catch((e=>{this.isLoading=!1,this.$httpMessageState(e.response,"錯誤訊息")}))},openModal(e){this.isLoadingItem=e.id,this.orderShow={...e},this.isNew=!1,this.$refs.orderDetail.openModal(),this.isLoadingItem="",this.isLoading=!1},openDelModal(e){this.isLoadingItem=e.id,this.orderShow={...e},this.$refs.delModal.openModal(),this.isLoadingItem="",this.isLoading=!1},updatePaid(e){this.isLoadingItem=e.id;const t=`https://vue3-course-api.hexschool.io/v2//api/brunoyu2022/admin/order/${e.id}`,a={is_paid:e.is_paid};this.$http.put(t,{data:a}).then((e=>{this.$refs.orderDetail.closeModal(),this.getOrders(this.currentPage),this.$httpMessageState(e,"更新付款狀態"),this.isLoadingItem="",this.isLoading=!1})).catch((e=>{this.$httpMessageState(e.response,"錯誤訊息"),this.isLoadingItem="",this.isLoading=!1}))},delOrder(){this.isLoadingItem=this.orderShow.id;const e=`https://vue3-course-api.hexschool.io/v2//api/brunoyu2022/admin/order/${this.orderShow.id}`;this.$http.delete(e).then((()=>{this.$refs.delModal.closeModal(),this.isLoadingItem="",this.getOrders(this.currentPage)})).catch((e=>{this.$httpMessageState(e.response,"錯誤訊息"),this.isLoadingItem=""})),this.isLoadingItem="",this.isLoading=!1}},created(){this.isLoading=!0,this.getOrders(),this.isLoading=!1}};const ye=(0,ge.Z)(ke,[["render",L]]);var De=ye}}]);
//# sourceMappingURL=529.1754c624.js.map